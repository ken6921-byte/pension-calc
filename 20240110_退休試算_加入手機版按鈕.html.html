<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="é€€ä¼‘å‹ä¸å‹ - ä½ çš„é€€ä¼‘é‡‘è©¦ç®—ç¥å™¨">
    <meta property="og:description" content="å‹ä¿ã€å‹é€€ã€åœ‹ä¿ã€ç¤¾æœƒç¦åˆ©ï¼Œä¸€éµè©¦ç®—ä½ çš„é€€ä¼‘ç”Ÿæ´»é‡‘ï¼">
    <meta property="og:type" content="website">

    <title>é€€ä¼‘å‹ä¸å‹ - ä½ çš„é€€ä¼‘é‡‘è©¦ç®—ç¥å™¨</title>
    <style>
        :root {
            --primary: #2c3e50;
            --lb-color: #3498db;
            --lt-color: #e67e22;
            --np-color: #2ecc71;
            --wf-color: #9b59b6;
            --bg-color: #f0f2f5;
            --line-green: #00B900; /* LINE å®˜æ–¹ç¶ è‰² */
            --highlight-red: #e74c3c;
        }
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            padding: 20px;
            color: #333;
            line-height: 1.5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
            margin-bottom: 80px; /* é ç•™åº•éƒ¨ç©ºé–“çµ¦æ‰‹æ©Ÿç‰ˆæ‡¸æµ®æŒ‰éˆ• */
        }
        h1 { 
            text-align: center; color: var(--primary); margin-bottom: 5px; 
            font-size: 2.2em; letter-spacing: 2px;
        }
        .subtitle { 
            text-align: center; color: #7f8c8d; margin-bottom: 35px; font-weight: 300;
        }
        .section-header {
            display: flex; align-items: center; border-bottom: 2px solid #eee;
            padding-bottom: 10px; margin-top: 35px; margin-bottom: 20px;
        }
        .badge {
            padding: 5px 12px; border-radius: 20px; color: white; font-weight: bold;
            margin-right: 12px; font-size: 0.9em; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .bg-lb { background-color: var(--lb-color); }
        .bg-lt { background-color: var(--lt-color); }
        .bg-np { background-color: var(--np-color); }
        .bg-wf { background-color: var(--wf-color); }
        .section-title { font-size: 1.3em; font-weight: bold; color: var(--primary); }

        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 600px) { .input-grid { grid-template-columns: 1fr; } }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        .hint-text { font-size: 0.85em; color: #888; margin-top: 4px; display: block; }
        
        .dynamic-hint {
            font-size: 0.95em; color: #d35400; margin-bottom: 8px; font-weight: bold;
            background: #fff8e1; padding: 8px 12px; border-radius: 6px; display: inline-block;
            border-left: 4px solid #f39c12;
            width: 100%; box-sizing: border-box;
        }

        input, select {
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;
            box-sizing: border-box; font-size: 1em; background: #fff;
        }
        input:focus, select:focus { outline: none; border-color: var(--lb-color); box-shadow: 0 0 5px rgba(52, 152, 219, 0.3); }
        
        .checkbox-group {
            display: flex; align-items: center; background: #f9f9f9; padding: 15px;
            border-radius: 8px; border: 1px solid #eee; cursor: pointer;
        }
        .checkbox-group input { width: auto; margin-right: 10px; transform: scale(1.2); }
        
        .btn-group { display: grid; grid-template-columns: 3fr 1fr; gap: 15px; margin-top: 40px; }

        .btn-calc {
            width: 100%; padding: 16px; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white; border: none; border-radius: 10px; font-size: 1.2em; cursor: pointer;
            font-weight: bold; box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
            transition: transform 0.2s;
        }
        .btn-calc:hover { transform: translateY(-2px); }

        .btn-reset {
            width: 100%; padding: 16px; background: #ecf0f1; color: #7f8c8d;
            border: 1px solid #bdc3c7; border-radius: 10px; font-size: 1em; cursor: pointer;
            font-weight: bold; transition: 0.2s;
        }
        .btn-reset:hover { background: #dfe6e9; color: #2c3e50; }

        #resultArea { display: none; margin-top: 40px; animation: fadeIn 0.6s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 15px; border-radius: 8px; overflow: hidden; border: 1px solid #eee; }
        th, td { padding: 15px; text-align: center; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #666; font-weight: bold; }
        .total-row { background-color: #fff8e1; color: #d35400; font-weight: bold; font-size: 1.1em; }
        
        .bar-chart-container {
            display: flex; height: 35px; width: 100%; border-radius: 20px;
            overflow: hidden; margin-top: 20px; background-color: #eee;
        }
        .bar-segment {
            height: 100%; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 0.85em; font-weight: bold; transition: width 1s ease-in-out;
        }

        .note {
            font-size: 0.9em; color: #555; margin-top: 30px; background: #f8f9fa;
            padding: 20px; border-radius: 8px; line-height: 1.8; border-left: 4px solid var(--primary);
        }
        .hl { color: var(--highlight-red); font-weight: bold; }

        /* --- å®£å‚³åŠŸèƒ½æ¨£å¼ (å„ªåŒ–ç‰ˆ) --- */
        
        .promo-fab {
            position: fixed; bottom: 30px; right: 30px;
            background-color: var(--line-green); color: white;
            padding: 15px 25px; border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 185, 0, 0.4);
            cursor: pointer; z-index: 1000;
            font-weight: bold; font-size: 1.1em;
            display: flex; align-items: center; gap: 10px;
            transition: transform 0.3s;
            animation: bounce 2s infinite;
        }
        .promo-fab:hover { transform: scale(1.05); background-color: #00a000; }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none; justify-content: center; align-items: center;
            z-index: 2000; backdrop-filter: blur(3px);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white; padding: 40px; border-radius: 15px;
            text-align: center; max-width: 400px; width: 90%;
            position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: popUp 0.3s;
        }
        
        @keyframes popUp { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

        .modal-close {
            position: absolute; top: 15px; right: 15px;
            font-size: 24px; color: #999; cursor: pointer;
            width: 30px; height: 30px; line-height: 30px;
        }
        .modal-close:hover { color: #333; }

        .qr-image {
            width: 200px; height: 200px; margin: 20px auto;
            border: 2px solid #eee; padding: 10px; border-radius: 10px;
        }

        .line-btn {
            display: block; width: 100%; padding: 15px;
            background-color: var(--line-green); color: white;
            text-decoration: none; border-radius: 8px;
            font-weight: bold; font-size: 1.1em;
            margin-top: 15px;
        }
        .line-btn:hover { background-color: #00a000; }

        /* --- æ‰‹æ©Ÿç‰ˆå°ˆå±¬å„ªåŒ– (Mobile Optimization) --- */
        /* ç•¶è¢å¹•å°æ–¼ 600px (æ‰‹æ©Ÿ) æ™‚ï¼Œéš±è— QR Codeï¼Œåªç•™å¤§æŒ‰éˆ• */
        @media (max-width: 600px) {
            .qr-image { display: none; } /* éš±è— QR Code */
            .modal-content { padding: 30px 20px; } /* èª¿æ•´å…§è· */
            .promo-fab { 
                bottom: 20px; right: 20px; /* èª¿æ•´æŒ‰éˆ•ä½ç½® */
                padding: 12px 20px; font-size: 1em;
            }
        }

        @media print {
            body { background-color: #fff; padding: 0; }
            .container { box-shadow: none; max-width: 100%; padding: 0; }
            .input-grid, .section-header, .form-group, .btn-group, .subtitle, .promo-fab, .modal-overlay { display: none; }
            #resultArea { display: block !important; margin-top: 0; }
            h1 { font-size: 1.8em; margin-bottom: 20px; }
            .note::after { content: " (æ­¤å ±è¡¨ç”± é€€ä¼‘å‹ä¸å‹ ç¶²ç«™ç”¢ç”Ÿ)"; display: block; margin-top: 10px; font-style: italic; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>é€€ä¼‘å‹ä¸å‹</h1>
    <div class="subtitle">å‹ä¿ãƒ»å‹é€€ãƒ»åœ‹ä¿ãƒ»ç¤¾ç¦ï½œå…¨æ–¹ä½è©¦ç®—</div>

    <div class="section-header">
        <span class="badge bg-lb">1</span>
        <span class="section-title">å‹ä¿ (Labor Insurance)</span>
    </div>
    <div class="input-grid">
        <div class="form-group">
            <label>æ‚¨çš„å‡ºç”Ÿå¹´ä»½ (è¥¿å…ƒ)</label>
            <input type="number" id="birthYear" placeholder="ä¾‹å¦‚: 1985" oninput="updateSmartHint()">
        </div>
        <div class="form-group">
            <label>å‹ä¿æŠ•ä¿å¹´è³‡ (å¹´)</label>
            <input type="number" id="lbYears" placeholder="ä¾‹å¦‚: 30" step="0.5">
            <span class="hint-text" style="color:#e67e22;">ğŸ’¡ æœˆé ˜å¹´è³‡ç„¡ä¸Šé™ / ä¸€æ¬¡é ˜ä¸Šé™ 45 åŸºæ•¸</span>
        </div>
        <div class="form-group">
            <label>æœ€é«˜ 60 å€‹æœˆå¹³å‡è–ªè³‡</label>
            <input type="number" id="lbSalary" placeholder="ä¾‹å¦‚: 45800">
        </div>
        
        <div class="form-group">
            <label>é€€ä¼‘æ™‚æ©Ÿ (å±•å»¶/æ¸›çµ¦)</label>
            <div id="smartAgeHint" class="dynamic-hint" style="display:none;"></div>
            <select id="lbRetireTime" onchange="updateSmartHint()">
                <option value="-20">ææ—© 5 å¹´ (æ¸›çµ¦ 20%)</option>
                <option value="-16">ææ—© 4 å¹´ (æ¸›çµ¦ 16%)</option>
                <option value="-12">ææ—© 3 å¹´ (æ¸›çµ¦ 12%)</option>
                <option value="-8">ææ—© 2 å¹´ (æ¸›çµ¦ 8%)</option>
                <option value="-4">ææ—© 1 å¹´ (æ¸›çµ¦ 4%)</option>
                <option value="0" selected>ç¬¦åˆæ³•å®šå¹´é½¡ (æ­£å¸¸çµ¦ä»˜)</option>
                <option value="4">å»¶å¾Œ 1 å¹´ (å¢çµ¦ 4%)</option>
                <option value="8">å»¶å¾Œ 2 å¹´ (å¢çµ¦ 8%)</option>
                <option value="12">å»¶å¾Œ 3 å¹´ (å¢çµ¦ 12%)</option>
                <option value="16">å»¶å¾Œ 4 å¹´ (å¢çµ¦ 16%)</option>
                <option value="20">å»¶å¾Œ 5 å¹´ (å¢çµ¦ 20%)</option>
            </select>
        </div>
    </div>

    <div class="section-header">
        <span class="badge bg-lt">2</span>
        <span class="section-title">å‹é€€æ–°åˆ¶ (Pension Fund)</span>
    </div>
    <div class="input-grid">
        <div class="form-group">
            <label>å€‹äººå°ˆæˆ¶ç´¯ç©ç¸½é‡‘é¡</label>
            <input type="number" id="ltBalance" placeholder="å¯è‡³å‹ä¿å±€æŸ¥è©¢">
            <span class="hint-text">ğŸ’¡ åƒè€ƒå€¼ï¼šåœ‹äººå¹³å‡ææ’¥ç´¯ç©é‡‘é¡ç´„ 60 è¬</span>
        </div>
        <div class="form-group">
            <label>é è¨ˆé ˜å–å¹´æ•¸ (è‡ªè¨‚é¤˜å‘½)</label>
            <input type="number" id="lifeExpectancy" value="24" min="1" max="50">
            <span class="hint-text">é è¨­ 24 å¹´ (ä¾å¹³å‡é¤˜å‘½ä¼°ç®—)</span>
        </div>
    </div>

    <div class="section-header">
        <span class="badge bg-np">3</span>
        <span class="section-title">åœ‹æ°‘å¹´é‡‘ (åœ‹ä¿)</span>
    </div>
    <div class="input-grid">
        <div class="form-group">
            <label>åœ‹ä¿å¹´è³‡ (å¹´)</label>
            <input type="number" id="npYears" placeholder="ä¾‹å¦‚: 0" step="0.5">
        </div>
        <div class="form-group">
            <label>æœˆæŠ•ä¿é‡‘é¡</label>
            <input type="number" id="npSalary" value="19761" readonly style="background:#eee; color:#888;">
        </div>
    </div>

    <div class="section-header">
        <span class="badge bg-wf">4</span>
        <span class="section-title">å…¶ä»–ç¦åˆ© (ç¤¾æœƒæ•‘åŠ©)</span>
    </div>
    <div class="form-group">
        <label class="checkbox-group">
            <input type="checkbox" id="welfareCheck">
            <div>
                <strong>ç¬¦åˆã€Œä¸­ä½æ”¶å…¥è€äººç”Ÿæ´»æ´¥è²¼ã€è³‡æ ¼</strong><br>
                <span style="font-size:0.85em; color:#777; font-weight:normal;">é©ç”¨æ–¼é€€ä¼‘å¾Œç„¡ç©©å®šæ”¶å…¥ä¸”è³‡ç”¢ä½æ–¼æ¨™æº–è€… (é ä¼° $3,879)</span>
            </div>
        </label>
    </div>

    <div class="btn-group">
        <button class="btn-calc" onclick="calculateAll()">è©¦ç®—æˆ‘çš„é€€ä¼‘ç”Ÿæ´»</button>
        <button class="btn-reset" onclick="resetAll()">æ¸…é™¤</button>
    </div>

    <div id="resultArea">
        <h3 style="text-align:center; color:#2c3e50; margin-bottom:20px;">ğŸ’° è©¦ç®—çµæœåˆ†æ</h3>
        
        <div style="text-align:center; font-size:0.9em; color:#555; margin-bottom:5px;">æ¯æœˆæ”¶å…¥çµ„æˆçµæ§‹</div>
        <div class="bar-chart-container" id="barChart"></div>

        <table>
            <thead>
                <tr>
                    <th>ä¾†æºé …ç›®</th>
                    <th>æœˆé ˜é‡‘é¡ (æ¯æœˆ)</th>
                    <th>ä¸€æ¬¡é ˜ (æ•´ç­†)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
            <tfoot>
                <tr class="total-row">
                    <td>ç¸½è¨ˆé ä¼°</td>
                    <td id="totalMonthly">0</td>
                    <td id="totalLumpSum">0</td>
                </tr>
            </tfoot>
        </table>

        <div class="note">
            <h4 style="margin-top:0; color:#2c3e50;">ğŸ’¡ ç¦åˆ©å°è£œå¸–ï¼š</h4>
            <ul style="padding-left: 20px;">
                <li><strong>å‹ä¿</strong>ï¼š<span class="hl">ä¸»è¦é€€ä¼‘æ”¶å…¥ä¾†æº</span>ï¼Œå¯é¸æ“‡<span class="hl">æå‰æˆ–å»¶å¾Œé ˜å–</span>ã€‚<br><span style="font-size:0.9em; color:#666;">(æ³•å®šå¹´é½¡ï¼šä¾å‡ºç”Ÿå¹´æ¬¡ä¸åŒï¼Œä»‹æ–¼ 60~65 æ­²)</span></li>
                <li><strong>å‹é€€</strong>ï¼šæ‚¨å€‹äººçš„å„²è“„å¸³æˆ¶ï¼Œ<span class="hl">é ˜å®Œå°±æ²’äº†</span> (æ­¤è™•ä»¥æ”¤ææ–¹å¼æ¨¡æ“¬æœˆé ˜)ã€‚</li>
                <li><strong>åœ‹ä¿</strong>ï¼šé‡å°<span class="hl">æœªåƒåŠ å‹ä¿æœŸé–“</span>çš„è£œè²¼ã€‚</li>
                <li><strong>ä¸­ä½æ”¶å…¥è€äººç”Ÿæ´»æ´¥è²¼</strong>ï¼šé€™å±¬æ–¼<span class="hl">ç¤¾æœƒæ•‘åŠ©</span>ã€‚è‹¥æ‚¨çš„å®¶åº­ç¸½æ”¶å…¥å¹³å‡åˆ†é…æ¯äººæ¯æœˆ<span class="hl">ä½æ–¼æœ€ä½ç”Ÿæ´»è²» 2.5 å€</span> (ä¸”æœªè¶…éä¸€å®šè³‡ç”¢ä¸Šé™)ï¼Œå¯å‘æˆ¶ç±åœ°å…¬æ‰€ç”³è«‹ã€‚ç›®å‰é‡‘é¡ç´„ç‚º $3,879 ~ $7,759 (æœ¬è©¦ç®—ä»¥ $3,879 ä¼°è¨ˆ)ã€‚</li>
                <li style="margin-top:10px; list-style:none;">âš ï¸ <strong>æ³¨æ„</strong>ï¼šä»¥ä¸Šé‡‘é¡ç‚ºé ä¼°å€¼ï¼Œ<span class="hl">å¯¦éš›é‡‘é¡ä»¥æ”¿åºœæ ¸å®šç‚ºæº–</span>ã€‚</li>
            </ul>
        </div>
    </div>
</div>

<div class="promo-fab" onclick="openModal()">
    ğŸ’¬ é»æˆ‘äº†è§£ / å°ˆäººè«®è©¢
</div>

<div id="lineModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModalBtn()">&times;</span>
        
        <h3 style="color:#2c3e50; margin-bottom:10px;">æƒ³äº†è§£æ›´å®Œæ•´çš„é€€ä¼‘è¦åŠƒï¼Ÿ</h3>
        <p style="color:#666; margin-bottom:20px;">åŠ å…¥å®˜æ–¹ LINE å¥½å‹ï¼Œç²å¾—æœ€æ–°è³‡è¨Šèˆ‡å…è²»è«®è©¢ï¼</p>
        
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://line.me/ti/p/YOUR_LINE_ID" alt="LINE QR Code" class="qr-image">
        
        <a href="https://line.me/ti/p/YOUR_LINE_ID" target="_blank" class="line-btn">
            åŠ å…¥ LINE å¥½å‹
        </a>
    </div>
</div>
<script>
    function openModal() { document.getElementById('lineModal').style.display = 'flex'; }
    function closeModal(event) { if (event.target.id === 'lineModal') document.getElementById('lineModal').style.display = 'none'; }
    function closeModalBtn() { document.getElementById('lineModal').style.display = 'none'; }

    function updateSmartHint() {
        const year = parseInt(document.getElementById('birthYear').value);
        const hintBox = document.getElementById('smartAgeHint');
        const percentage = parseInt(document.getElementById('lbRetireTime').value);
        
        hintBox.style.display = 'inline-block';
        if (!year || year < 1900 || year > 2100) {
            hintBox.innerHTML = '<span style="color:#7f8c8d;">è«‹å…ˆè¼¸å…¥ä¸Šæ–¹ã€Œå‡ºç”Ÿå¹´ä»½ã€ä»¥è¨ˆç®—é€€ä¼‘å¹´é½¡</span>';
            return;
        }

        let baseAge = 60;
        if (year >= 1962) { baseAge = 65; } 
        else if (year === 1958) { baseAge = 61; } 
        else if (year === 1959) { baseAge = 62; } 
        else if (year === 1960) { baseAge = 63; } 
        else if (year === 1961) { baseAge = 64; }

        const shiftYears = percentage / 4;
        const finalAge = baseAge + shiftYears;
        let actionText = "";
        if (shiftYears < 0) actionText = ` - ${Math.abs(shiftYears)} å¹´ (æå‰)`;
        else if (shiftYears > 0) actionText = ` + ${shiftYears} å¹´ (å»¶å¾Œ)`;

        if (shiftYears !== 0) {
            hintBox.innerHTML = `ğŸ’¡ æ³•å®š ${baseAge} æ­²${actionText} = <span style="font-size:1.1em; color:#c0392b; background:#fff;">${finalAge} æ­²é€€ä¼‘</span>`;
        } else {
            hintBox.innerHTML = `ğŸ’¡ ä¾æ“šæ‚¨çš„å‡ºç”Ÿå¹´ï¼Œæ³•å®šè«‹é ˜å¹´é½¡ç‚ºï¼š${baseAge} æ­²`;
        }
    }

    function calculateAll() {
        const lbYears = parseFloat(document.getElementById('lbYears').value) || 0;
        const lbSalary = parseFloat(document.getElementById('lbSalary').value) || 0;
        const lbPercentage = parseInt(document.getElementById('lbRetireTime').value); 

        let lbMonthlyA = (lbSalary * lbYears * 0.00775) + 3000;
        let lbMonthlyB = (lbSalary * lbYears * 0.0155);
        let lbBaseMonthly = Math.max(lbMonthlyA, lbMonthlyB);
        let lbMonthly = Math.round(lbBaseMonthly * (1 + (lbPercentage / 100)));

        let lbLumpSumUnits = (lbYears <= 15) ? lbYears * 1 : 15 + ((lbYears - 15) * 2);
        if (lbLumpSumUnits > 45) lbLumpSumUnits = 45; 
        let lbLumpSum = Math.round(lbSalary * lbLumpSumUnits);

        const ltBalance = parseFloat(document.getElementById('ltBalance').value) || 0;
        const lifeYears = parseFloat(document.getElementById('lifeExpectancy').value) || 24;
        
        let ltLumpSum = ltBalance;
        let ltMonths = lifeYears * 12;
        let ltMonthly = (ltBalance > 0 && ltMonths > 0) ? Math.round(ltBalance / ltMonths) : 0;

        const npYears = parseFloat(document.getElementById('npYears').value) || 0;
        const npSalary = 19761; 
        let npMonthlyA = (npSalary * npYears * 0.0065) + 4049;
        let npMonthlyB = (npSalary * npYears * 0.013);
        let npMonthly = (npYears > 0) ? Math.round(Math.max(npMonthlyA, npMonthlyB)) : 0;
        let npLumpSum = 0; 

        const isWelfare = document.getElementById('welfareCheck').checked;
        let wfMonthly = isWelfare ? 3879 : 0;

        const totalMonthly = lbMonthly + ltMonthly + npMonthly + wfMonthly;
        const totalLumpSum = lbLumpSum + ltLumpSum;

        const tbody = document.getElementById('resultBody');
        let wfDisplay = isWelfare ? 
            `<tr>
                <td style="text-align:left;"><span style="color:var(--wf-color);">â—</span> ç¤¾æœƒç¦åˆ©æ´¥è²¼</td>
                <td style="color:#2980b9;">$${wfMonthly.toLocaleString()}</td>
                <td style="color:#bbb;">-</td>
            </tr>` : '';

        tbody.innerHTML = `
            <tr>
                <td style="text-align:left;">
                    <span style="color:var(--lb-color);">â—</span> å‹ä¿å¹´é‡‘ 
                    <small style="color:#999;">(${lbPercentage !== 0 ? (lbPercentage > 0 ? '+' : '') + lbPercentage + '%' : 'æ¨™æº–'})</small>
                </td>
                <td style="color:#2980b9; font-weight:bold;">$${lbMonthly.toLocaleString()}</td>
                <td style="color:#27ae60;">$${lbLumpSum.toLocaleString()}</td>
            </tr>
            <tr>
                <td style="text-align:left;">
                    <span style="color:var(--lt-color);">â—</span> å‹é€€æ–°åˆ¶
                    <small style="color:#999;">(åˆ†${lifeYears}å¹´)</small>
                </td>
                <td style="color:#2980b9;">$${ltMonthly.toLocaleString()}</td>
                <td style="color:#27ae60;">$${ltLumpSum.toLocaleString()}</td>
            </tr>
            <tr>
                <td style="text-align:left;"><span style="color:var(--np-color);">â—</span> åœ‹æ°‘å¹´é‡‘</td>
                <td style="color:#2980b9;">$${npMonthly.toLocaleString()}</td>
                <td style="color:#bbb;">-</td>
            </tr>
            ${wfDisplay}
        `;

        document.getElementById('totalMonthly').innerText = "$" + totalMonthly.toLocaleString();
        document.getElementById('totalLumpSum').innerText = "$" + totalLumpSum.toLocaleString();

        const chart = document.getElementById('barChart');
        if (totalMonthly > 0) {
            const pLB = (lbMonthly / totalMonthly) * 100;
            const pLT = (ltMonthly / totalMonthly) * 100;
            const pNP = (npMonthly / totalMonthly) * 100;
            const pWF = (wfMonthly / totalMonthly) * 100;

            let html = '';
            if(pLB > 0) html += `<div class="bar-segment bg-lb" style="width:${pLB}%">å‹ä¿ ${Math.round(pLB)}%</div>`;
            if(pLT > 0) html += `<div class="bar-segment bg-lt" style="width:${pLT}%">å‹é€€ ${Math.round(pLT)}%</div>`;
            if(pNP > 0) html += `<div class="bar-segment bg-np" style="width:${pNP}%">åœ‹ä¿ ${Math.round(pNP)}%</div>`;
            if(pWF > 0) html += `<div class="bar-segment bg-wf" style="width:${pWF}%">ç¦åˆ© ${Math.round(pWF)}%</div>`;
            
            chart.innerHTML = html;
        } else {
            chart.innerHTML = `<div style="width:100%; text-align:center; line-height:35px; color:#aaa;">è«‹è¼¸å…¥è³‡æ–™é–‹å§‹è©¦ç®—</div>`;
        }

        document.getElementById('resultArea').style.display = 'block';
    }

    function resetAll() {
        document.querySelectorAll('input').forEach(input => {
            if(input.type === 'checkbox') input.checked = false;
            else if(input.readOnly === false && input.id !== 'lifeExpectancy') input.value = '';
        });
        document.getElementById('lbRetireTime').value = "0";
        document.getElementById('lifeExpectancy').value = "24";
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('smartAgeHint').style.display = 'none';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>

</body>
</html>